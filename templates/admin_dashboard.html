<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Student Management System</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <link rel="shortcut icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    
    <!-- DataTables CSS for better mobile experience -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.dataTables.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-title h1 {
            color: #4a5568;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-subtitle {
            color: #718096;
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.9rem;
            color: #4a5568;
        }

        .logout-btn {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c53030;
            transform: translateY(-1px);
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        /* Stats Grid */
        .stats-section {
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem 1rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #4299e1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Section Cards */
        .section-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .section-header {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .section-content {
            padding: 1.5rem;
        }

        /* Action Grid */
        .action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .action-btn {
            background: linear-gradient(135deg, #4299e1, #3182ce);
            color: white;
            border: none;
            padding: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(66, 153, 225, 0.3);
        }

        .action-icon {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
        }

        /* Class Grid */
        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .class-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 10px;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .class-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .class-btn:hover::before {
            left: 100%;
        }

        .class-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.3);
        }

        /* Data View Section */
        .data-view-section {
            display: none;
        }

        .view-controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 0.75rem 1rem;
            border: 2px solid #4299e1;
            background: white;
            color: #4299e1;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .view-btn.active,
        .view-btn:hover {
            background: #4299e1;
            color: white;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            font-size: 0.85rem;
        }

        .data-table th,
        .data-table td {
            padding: 0.6rem 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            word-wrap: break-word;
            max-width: 150px;
        }

        .data-table th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            font-size: 0.8rem;
            white-space: nowrap;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .data-table tr:hover {
            background: #f0f9ff;
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        /* Specific column widths for better layout */
        .data-table th:nth-child(1), .data-table td:nth-child(1) { width: 60px; } /* S.No */
        .data-table th:nth-child(2), .data-table td:nth-child(2) { width: 80px; } /* GR# */
        .data-table th:nth-child(3), .data-table td:nth-child(3) { width: 180px; } /* Student Name */
        .data-table th:nth-child(4), .data-table td:nth-child(4) { width: 150px; } /* Father's Name */
        .data-table th:nth-child(5), .data-table td:nth-child(5) { width: 80px; } /* Gender */
        .data-table th:nth-child(6), .data-table td:nth-child(6) { width: 100px; } /* Religion */
        .data-table th:nth-child(7), .data-table td:nth-child(7) { width: 120px; } /* Contact */
        .data-table th:nth-child(8), .data-table td:nth-child(8) { width: 130px; } /* CNIC */
        .data-table th:nth-child(9), .data-table td:nth-child(9) { width: 100px; } /* DOB */
        .data-table th:nth-child(10), .data-table td:nth-child(10) { width: 120px; } /* Guardian */
        .data-table th:nth-child(11), .data-table td:nth-child(11) { width: 80px; } /* Class */
        .data-table th:nth-child(12), .data-table td:nth-child(12) { width: 80px; } /* Section */
        .data-table th:nth-child(13), .data-table td:nth-child(13) { width: 120px; } /* Remarks */
        .data-table th:nth-child(14), .data-table td:nth-child(14) { width: 140px; } /* Actions */

        .table-btn {
            padding: 0.4rem 0.8rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            margin-right: 0.5rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            height: 32px;
        }

        .btn-view {
            background: #4299e1;
            color: white;
        }

        .btn-view:hover {
            background: #3182ce;
        }

        .btn-edit {
            background: #48bb78;
            color: white;
        }

        .btn-edit:hover {
            background: #38a169;
        }

        .btn-print {
            background: #805ad5;
            color: white;
        }

        .btn-print:hover {
            background: #6b46c1;
        }

        .btn-delete {
            background: #e53e3e;
            color: white;
        }

        .btn-delete:hover {
            background: #c53030;
        }

        /* Loading and Messages */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #718096;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .success {
            background: #c6f6d5;
            color: #22543d;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }

            .header-title h1 {
                font-size: 1.3rem;
            }

            .container {
                padding: 0.5rem;
            }

            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.5rem;
            }

            .stat-card {
                padding: 1rem 0.5rem;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .stat-label {
                font-size: 0.8rem;
            }

            .section-content {
                padding: 1rem;
            }

            .action-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .action-btn {
                padding: 1rem 0.5rem;
                font-size: 0.85rem;
            }

            .action-icon {
                font-size: 1.2rem;
            }

            .class-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 0.75rem;
            }

            .class-btn {
                padding: 0.75rem 0.5rem;
                font-size: 0.85rem;
            }

            .view-controls {
                overflow-x: auto;
                padding-bottom: 0.5rem;
                -webkit-overflow-scrolling: touch;
            }

            .view-btn {
                flex-shrink: 0;
                padding: 0.6rem 0.8rem;
                font-size: 0.8rem;
            }

        /* Mobile ID Card Layout - Clean and Professional */
        @media (max-width: 768px) {
            /* Force table to be responsive */
            .data-table {
                font-size: 0.9rem !important;
                border: none !important;
                background: transparent !important;
            }

            /* Hide table headers on mobile */
            .data-table thead {
                display: none !important;
            }

            /* Force all table elements to be blocks */
            .data-table tbody, 
            .data-table tr, 
            .data-table td {
                display: block !important;
                width: 100% !important;
                float: none !important;
                clear: both !important;
            }

            /* Style each row as an ID card */
            .data-table tr {
                background: white !important;
                border: 2px solid #e2e8f0 !important;
                margin-bottom: 1.5rem !important;
                border-radius: 16px !important;
                padding: 1.5rem !important;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                float: none !important;
                clear: both !important;
            }

            .data-table tr:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12) !important;
                border-color: #4299e1 !important;
            }

            /* Top accent line */
            .data-table tr:before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                height: 4px !important;
                background: linear-gradient(135deg, #4299e1, #667eea) !important;
                border-radius: 16px 16px 0 0 !important;
                opacity: 0.8 !important;
            }

            /* Style each cell for ID card layout */
            .data-table td {
                border: none !important;
                position: relative !important;
                padding: 0.8rem 0 !important;
                padding-left: 0 !important;
                text-align: left !important;
                white-space: normal !important;
                border-bottom: 1px solid #f1f5f9 !important;
                min-height: auto !important;
                display: block !important;
                align-items: flex-start !important;
                float: none !important;
                clear: both !important;
            }

            /* Show only essential information for ID card */
            .data-table td[data-label="S.No"],
            .data-table td[data-label="Gender"],
            .data-table td[data-label="Contact"],
            .data-table td[data-label="Section"] {
                display: none !important;
            }

            /* ID Card Information Layout */
            .data-table td[data-label="GR#"] {
                font-size: 1rem !important;
                font-weight: 600 !important;
                color: #2d3748 !important;
                padding-bottom: 0.5rem !important;
                border-bottom: 2px solid #e2e8f0 !important;
            }

            .data-table td[data-label="Student Name"] {
                font-size: 1.4rem !important;
                font-weight: 700 !important;
                color: #1a202c !important;
                padding: 1rem 0 0.5rem 0 !important;
                border-bottom: none !important;
            }

            .data-table td[data-label="Father's Name"] {
                font-size: 1rem !important;
                font-weight: 500 !important;
                color: #4a5568 !important;
                padding: 0.5rem 0 !important;
                border-bottom: none !important;
            }

            .data-table td[data-label="Class"] {
                font-size: 1rem !important;
                font-weight: 600 !important;
                color: #2b6cb0 !important;
                padding: 0.5rem 0 !important;
                border-bottom: none !important;
            }

            /* Remove border from last cell */
            .data-table td:last-child {
                border-bottom: none !important;
                padding-bottom: 0 !important;
            }

            /* Style labels for ID card */
            .data-table td:before {
                content: attr(data-label) !important;
                position: static !important;
                display: inline-block !important;
                font-weight: 600 !important;
                color: #718096 !important;
                font-size: 0.85rem !important;
                margin-right: 0.5rem !important;
                min-width: auto !important;
                height: auto !important;
            }

            /* Mobile Action Buttons - ID Card Style */
            .data-table td[data-label="Actions"] {
                padding: 1.5rem 0 0 0 !important;
                padding-left: 0 !important;
                justify-content: center !important;
                border-bottom: none !important;
                margin-top: 1rem !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                float: none !important;
                clear: both !important;
            }

            .data-table td[data-label="Actions"]:before {
                display: none !important;
            }

            /* Force action buttons to be visible in a single row */
            .action-buttons {
                display: flex !important;
                flex-direction: row !important;
                flex-wrap: nowrap !important;
                gap: 0.75rem !important;
                width: 100% !important;
                align-items: center !important;
                justify-content: center !important;
                float: none !important;
                clear: both !important;
            }

            .action-row {
                display: none !important;
            }

            /* Style action buttons for ID card */
            .action-buttons .table-btn {
                margin: 0 !important;
                padding: 0.8rem 1.2rem !important;
                font-size: 0.85rem !important;
                border-radius: 10px !important;
                min-width: 80px !important;
                flex: 1 !important;
                max-width: 100px !important;
                height: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                border: 2px solid #e2e8f0 !important;
                cursor: pointer !important;
                font-weight: 600 !important;
                transition: all 0.3s ease !important;
                background: white !important;
                color: #4a5568 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
                float: none !important;
                clear: both !important;
            }

            /* Button hover effects */
            .action-buttons .table-btn:hover {
                background: #4299e1 !important;
                border-color: #4299e1 !important;
                color: white !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 15px rgba(66, 153, 225, 0.3) !important;
            }

            /* Ensure buttons are clickable */
            .table-btn {
                pointer-events: auto !important;
                z-index: 10 !important;
            }
        }

        /* Clean, minimal button styles */
        .table-btn {
            background: transparent !important;
            border: 1px solid #e2e8f0 !important;
            color: #4a5568 !important;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .table-btn:hover {
            background: rgba(66, 153, 225, 0.1) !important;
            border-color: #4299e1 !important;
            color: #2b6cb0 !important;
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(66, 153, 225, 0.15);
        }

        .table-btn:active {
            transform: translateY(0);
            box-shadow: 0 1px 4px rgba(66, 153, 225, 0.2);
        }

        /* Remove old colorful button styles */
        .btn-view, .btn-edit, .btn-print, .btn-delete {
            background: transparent !important;
            border: 1px solid #e2e8f0 !important;
            color: #4a5568 !important;
        }

        .btn-view:hover, .btn-edit:hover, .btn-print:hover, .btn-delete:hover {
            background: rgba(66, 153, 225, 0.1) !important;
            border-color: #4299e1 !important;
            color: #2b6cb0 !important;
        }

        .mobile-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
            align-items: center;
        }

        .mobile-actions .table-btn {
            margin: 0.25rem;
            padding: 0.6rem 0.8rem;
            font-size: 0.75rem;
            border-radius: 6px;
            min-width: 60px;
            flex: 1;
            max-width: 80px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Ensure desktop view also shows buttons properly */
        .data-table td[data-label="Actions"] .mobile-actions {
            gap: 0.5rem;
            flex-wrap: nowrap;
        }

        .data-table td[data-label="Actions"] .mobile-actions .table-btn {
            flex: 0 1 auto;
            max-width: none;
        }

        /* Debug: Ensure action buttons are visible */
        .data-table td[data-label="Actions"] {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
        }

        .mobile-actions .table-btn {
            border: 1px solid transparent;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Hide less important columns on mobile */
        .data-table td[data-label="S.No"],
        .data-table td[data-label="GR#"],
        .data-table td[data-label="Father's Name"],
        .data-table td[data-label="Contact"],
        .data-table td[data-label="Section"] {
            display: none;
        }

        /* Show only essential data on mobile */
        .data-table td[data-label="Student Name"],
        .data-table td[data-label="Gender"],
        .data-table td[data-label="Class"] {
            display: flex;
        }

        /* Hide column width restrictions on mobile */
        .data-table th, .data-table td {
            max-width: none;
            width: auto;
        }
        }

        /* Student Cards Layout */
        .students-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
            padding: 1rem 0;
        }

        .student-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
        }

        .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            position: relative;
        }

        .card-header h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1.2rem;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        .card-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        .card-info div {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .card-info div::before {
            content: '‚Ä¢';
            color: rgba(255, 255, 255, 0.7);
            font-weight: bold;
        }

        .card-actions {
            padding: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            border-bottom: 1px solid #e2e8f0;
        }

        .card-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 80px;
        }

        .btn-details {
            background: #f7fafc;
            color: #4a5568;
            border: 1px solid #e2e8f0;
        }

        .btn-details:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }

        .btn-view {
            background: #4299e1;
            color: white;
        }

        .btn-view:hover {
            background: #3182ce;
        }

        .btn-delete {
            background: #f56565;
            color: white;
        }

        .btn-delete:hover {
            background: #e53e3e;
        }

        .card-details {
            display: none;
            padding: 1rem;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
        }

        .details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: #4a5568;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-size: 0.9rem;
            color: #2d3748;
            font-weight: 500;
        }

        /* Empty State Styling */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #718096;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: #4a5568;
        }

        .empty-state p {
            font-size: 0.95rem;
            opacity: 0.8;
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 50%;
            border-top-color: #4299e1;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Message Styles */
        .info {
            background: #bee3f8;
            color: #2b6cb0;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        /* Search Styles */
        #studentSearch:focus {
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
            outline: none;
        }

        #clearSearchBtn:hover {
            background: #c53030 !important;
            transform: scale(1.1);
        }

        /* Search active state */
        .search-active #studentSearch {
            border-color: #48bb78;
            background-color: #f0fff4;
        }

        @media (max-width: 480px) {
            .students-container {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .card-info {
                grid-template-columns: 1fr;
                gap: 0.25rem;
            }

            .card-actions {
                flex-direction: column;
            }

            .card-btn {
                flex: none;
                width: 100%;
            }

            .details-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }

            .action-grid {
                grid-template-columns: 1fr;
            }

            .class-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Developer Footer */
        .developer-footer {
            background: linear-gradient(135deg, #2d3748, #4a5568);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
            text-align: center;
        }

        .footer-logo {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #4299e1, #48bb78);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .footer-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }

        .footer-contact {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 2rem;
            margin-bottom: 1rem;
        }

        .contact-item {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .footer-copyright {
            font-size: 0.8rem;
            opacity: 0.7;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 1rem;
            margin-top: 1rem;
        }

        @media (max-width: 768px) {
            .footer-contact {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
                    <div class="header-title">
            <div style="display: flex; align-items: center; gap: 1rem;">
                <img src="{{ url_for('static', filename='logo.png') }}" alt="School Logo" style="width: 50px; height: 50px; object-fit: contain;" onerror="this.style.display='none'">
                <div>
                    <h1>üéì Admin Dashboard</h1>
                    <div class="header-subtitle">Govt Girls Secondary School Nishtar Road Khi</div>
                </div>
            </div>
        </div>
            <div class="user-info">
                <span>Welcome, Admin</span>
                <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Statistics Section -->
        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number">{{ total_students or 0 }}</div>
                    <div class="stat-label">Total Students</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">{{ total_classes or 11 }}</div>
                    <div class="stat-label">Total Classes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="active-users">1</div>
                    <div class="stat-label">Active Users</div>
                </div>
                <div class="stat-card" id="cache-status" style="cursor: pointer;" onclick="refreshCache()">
                    <div class="stat-number" id="cache-indicator">üîÑ</div>
                    <div class="stat-label">Cache Status</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="section-card">
            <div class="section-header">
                <div class="section-title">‚ö° Quick Actions</div>
                <div class="section-subtitle">Manage student data efficiently</div>
            </div>
            <div class="section-content">
                <div class="action-grid">
                    <a href="{{ url_for('form') }}" class="action-btn">
                        <div class="action-icon">‚ûï</div>
                        <div>Add New Student</div>
                    </a>
                    <button onclick="showAllData()" class="action-btn">
                        <div class="action-icon">üìä</div>
                        <div>View All Data</div>
                    </button>
                    <button onclick="showClassWiseData()" class="action-btn">
                        <div class="action-icon">üìã</div>
                        <div>Class-wise View</div>
                    </button>
                    <a href="{{ url_for('data_edit') }}" class="action-btn">
                        <div class="action-icon">Edit</div>
                        <div>Edit Data</div>
                    </a>
                    <a href="{{ url_for('reports') }}" class="action-btn">
                        <div class="action-icon">üìà</div>
                        <div>Generate Reports</div>
                    </a>
                    <button onclick="consolidateData()" class="action-btn">
                        <div class="action-icon">üìÅ</div>
                        <div>Consolidate Data</div>
                    </button>
                    <a href="{{ url_for('settings') }}" class="action-btn">
                        <div class="action-icon">Settings</div>
                        <div>Settings</div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Class Management Section -->
        <div class="section-card">
            <div class="section-header">
                <div class="section-title">Class Management</div>
                <div class="section-subtitle">Access individual class data</div>
            </div>
            <div class="section-content">
                <div class="class-grid">
                    <a href="{{ url_for('class_dashboard', class_name='ECE') }}" class="class-btn">ECE</a>
                    <a href="{{ url_for('class_dashboard', class_name='I') }}" class="class-btn">Class I</a>
                    <a href="{{ url_for('class_dashboard', class_name='II') }}" class="class-btn">Class II</a>
                    <a href="{{ url_for('class_dashboard', class_name='III') }}" class="class-btn">Class III</a>
                    <a href="{{ url_for('class_dashboard', class_name='IV') }}" class="class-btn">Class IV</a>
                    <a href="{{ url_for('class_dashboard', class_name='V') }}" class="class-btn">Class V</a>
                    <a href="{{ url_for('class_dashboard', class_name='VI') }}" class="class-btn">Class VI</a>
                    <a href="{{ url_for('class_dashboard', class_name='VII') }}" class="class-btn">Class VII</a>
                    <a href="{{ url_for('class_dashboard', class_name='VIII') }}" class="class-btn">Class VIII</a>
                    <a href="{{ url_for('class_dashboard', class_name='IX') }}" class="class-btn">Class IX</a>
                    <a href="{{ url_for('class_dashboard', class_name='X') }}" class="class-btn">Class X</a>
                </div>
            </div>
        </div>

        <!-- Data View Section -->
        <div class="section-card data-view-section" id="data-section">
            <div class="section-header">
                <div class="section-title">Student Data</div>
                <div class="section-subtitle">View and manage student information</div>
            </div>
            <div class="section-content">
                <div class="view-controls">
                    <button class="view-btn active" onclick="showAllData()">All Students</button>
                    <button class="view-btn" onclick="showClassWiseData()">Class-wise</button>
                    <button class="view-btn" onclick="filterByClass('ECE')">ECE</button>
                    <button class="view-btn" onclick="filterByClass('I')">Class I</button>
                    <button class="view-btn" onclick="filterByClass('II')">Class II</button>
                    <button class="view-btn" onclick="filterByClass('III')">Class III</button>
                    <button class="view-btn" onclick="filterByClass('IV')">Class IV</button>
                    <button class="view-btn" onclick="filterByClass('V')">Class V</button>
                </div>
                <div id="data-content">
                    <div class="loading">Loading data...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Developer Footer -->
    <div class="developer-footer">
        <div class="footer-content">
            <div class="footer-logo">MS</div>
            <div class="footer-text">Developed by <strong>MasterSahub</strong></div>
            <div class="footer-contact">
                <div class="contact-item">‚úâ Contact for Custom Solutions</div>
                <div class="contact-item">‚å® Web Development Services</div>
                <div class="contact-item">‚òé Mobile App Development</div>
                <div class="contact-item">‚ö° Educational Software Solutions</div>
            </div>
            <div class="footer-copyright">
                ¬© 2025 MasterSahub. Empowering Education Through Technology.
            </div>
        </div>
    </div>

    <script>
        // Show message function
        function showMessage(message, type = 'error') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Show all data
        function showAllData() {
            document.getElementById('data-section').style.display = 'block';
            document.getElementById('data-content').innerHTML = '<div class="loading">Loading all student data...</div>';
            
            // Smooth scroll to data section
            const dataSection = document.querySelector('.data-view-section');
            if (dataSection) {
                dataSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
            
            fetch('/api/all_students')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayStudentsTable(data.students);
                    } else {
                        document.getElementById('data-content').innerHTML = `<div class="error">Error: ${data.message}</div>`;
                    }
                })
                .catch(error => {
                    document.getElementById('data-content').innerHTML = `<div class="error">Error loading data: ${error.message}</div>`;
                });
        }
        
        // Display students table
        function displayStudentsTable(students) {
            if (students.length === 0) {
                document.getElementById('data-content').innerHTML = `
                    <div style="text-align: center; padding: 3rem; background: rgba(255,255,255,0.95); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                        <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üìà</div>
                        <h3 style="color: #4a5568; margin-bottom: 0.5rem;">No Students Found</h3>
                        <p style="color: #718096; margin: 0;">There are currently no students in the database.</p>
                    </div>
                `;
                return;
            }
            
            let tableHTML = `
                <div style="background: rgba(255,255,255,0.95); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden;">
                    <!-- Professional Header -->
                    <div style="background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 1.5rem; text-align: center;">
                        <h2 style="margin: 0 0 0.5rem 0; font-size: 1.5rem; font-weight: 600;">All Students Database</h2>
                        <p style="margin: 0; opacity: 0.9; font-size: 0.95rem;">Complete student records overview</p>
                    </div>
                    
                    <!-- Search and Filter Controls -->
                    <div style="padding: 1.5rem; border-bottom: 1px solid #e2e8f0; background: #f7fafc;">
                        <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap; justify-content: space-between;">
                            <div style="display: flex; gap: 1rem; align-items: center; flex: 1; min-width: 200px;">
                                <div style="position: relative; flex: 1; max-width: 400px;">
                                    <input type="text" id="studentSearch" placeholder="Search students by name, father's name, or GR#..." 
                                           style="width: 100%; padding: 0.75rem 1rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem; transition: all 0.3s ease;"
                                           oninput="filterStudents()" onfocus="this.style.borderColor='#4299e1'" onblur="this.style.borderColor='#e2e8f0'"
                                           title="Type to search students in real-time">
                                    <button onclick="clearSearch()" 
                                            style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: #e53e3e; color: white; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.75rem; display: none;"
                                            id="clearSearchBtn">
                                        ‚úï
                                    </button>
                                </div>
                                <select id="classFilter" onchange="filterStudents()" 
                                        style="padding: 0.75rem; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem; background: white; cursor: pointer;">
                                    <option value="">All Classes</option>
                                    <option value="ECE">ECE</option>
                                    <option value="I">Class I</option>
                                    <option value="II">Class II</option>
                                    <option value="III">Class III</option>
                                    <option value="IV">Class IV</option>
                                    <option value="V">Class V</option>
                                    <option value="VI">Class VI</option>
                                    <option value="VII">Class VII</option>
                                    <option value="VIII">Class VIII</option>
                                    <option value="IX">Class IX</option>
                                    <option value="X">Class X</option>
                                </select>
                            </div>
                            <div style="display: flex; gap: 0.5rem; align-items: center;">
                                <span style="background: #4299e1; color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.85rem; font-weight: 500;">
                                    Total: <span id="studentCount">${students.length}</span> students
                                </span>
                                <button onclick="exportStudentData()" 
                                        style="background: #48bb78; color: white; border: none; padding: 0.75rem 1rem; border-radius: 8px; cursor: pointer; font-size: 0.85rem; font-weight: 500; transition: all 0.3s ease;"
                                        onmouseover="this.style.background='#38a169'" onmouseout="this.style.background='#48bb78'">
                                    Export
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Students Table -->
                    <div style="padding: 0; background: white; overflow-x: auto;">
                        <table class="data-table" id="studentsDataTable">
                            <thead>
                                <tr>
                                    <th style="width: 60px;">S.No</th>
                                    <th style="width: 80px;">GR#</th>
                                    <th style="width: 180px;">Student Name</th>
                                    <th style="width: 150px;">Father's Name</th>
                                    <th style="width: 80px;">Gender</th>
                                    <th style="width: 120px;">Contact</th>
                                    <th style="width: 80px;">Class</th>
                                    <th style="width: 80px;">Section</th>
                                    <th style="width: 200px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            students.forEach((student, index) => {
                // Safely convert to string and then to lowercase for search functionality
                const studentNameLower = String(student.student_name || '').toLowerCase();
                const fatherNameLower = String(student.father_name || '').toLowerCase();
                const grNumberLower = String(student.gr_number || '').toLowerCase();
                
                tableHTML += `
                    <tr class="student-row" data-student-name="${studentNameLower}" 
                        data-father-name="${fatherNameLower}" 
                        data-gr-number="${grNumberLower}" 
                        data-class="${student.student_class}">
                        
                        <!-- Data Columns (Desktop) -->
                        <td data-label="S.No">${student.sno || 'N/A'}</td>
                        <td data-label="GR#">${student.gr_number || 'N/A'}</td>
                        <td data-label="Student Name" style="font-weight: 500;">${student.student_name || 'N/A'}</td>
                        <td data-label="Father's Name">${student.father_name || 'N/A'}</td>
                        <td data-label="Gender">
                            <span style="background: ${student.gender === 'Male' ? '#3182ce' : '#e53e3e'}; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500;">
                                ${student.gender || 'N/A'}
                            </span>
                        </td>
                        <td data-label="Contact" style="font-family: monospace;">${student.contact_number || 'N/A'}</td>
                        <td data-label="Class">
                            <span style="background: #4299e1; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500;">
                                ${student.student_class}
                            </span>
                        </td>
                        <td data-label="Section">
                            <span style="background: #48bb78; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; font-weight: 500;">
                                ${student.class_section || 'N/A'}
                            </span>
                        </td>
                        
                        <!-- Actions Column with ALL FOUR BUTTONS in Two Rows -->
                        <td data-label="Actions">
                            <div class="action-buttons">
                                <!-- Row 1: View and Edit -->
                                <div class="action-row">
                                    <button onclick="viewStudent('${student.sheet_name}', ${student.row_number})" 
                                            class="table-btn btn-view" title="View Student">
                                        View
                                    </button>
                                    <button onclick="editStudent('${student.sheet_name}', ${student.row_number})" 
                                            class="table-btn btn-edit" title="Edit Student">
                                        Edit
                                    </button>
                                </div>
                                <!-- Row 2: Print and Delete -->
                                <div class="action-row">
                                    <button onclick="printStudent('${student.sheet_name}', ${student.row_number}, '${student.student_name}')" 
                                            class="table-btn btn-print" title="Print Student">
                                        Print
                                    </button>
                                    <button onclick="deleteStudent('${student.sheet_name}', ${student.row_number}, '${student.student_name}')" 
                                            class="table-btn btn-delete" title="Delete Student">
                                        Del
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableHTML += `
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Professional Footer -->
                    <div style="background: #f7fafc; padding: 1rem 1.5rem; border-top: 1px solid #e2e8f0; text-align: center;">
                        <p style="margin: 0; color: #718096; font-size: 0.85rem;">
                            Displaying <span id="visibleCount">${students.length}</span> of ${students.length} students | 
                            Govt Girls Secondary School Nishtar Road Khi
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('data-content').innerHTML = tableHTML;
            
            // Initialize DataTable for better mobile experience (without pagination/search controls)
            setTimeout(() => {
                if (typeof $ !== 'undefined' && $.fn.DataTable) {
                    $('#studentsDataTable').DataTable({
                        responsive: true,
                        pageLength: 1000, // Show all students
                        lengthMenu: false, // Hide length menu
                        searching: false, // Hide search box
                        info: false, // Hide info text
                        paging: false, // Hide pagination
                        ordering: true, // Keep sorting
                        columnDefs: [
                            {
                                targets: -1, // Actions column
                                orderable: false,
                                searchable: false,
                                width: '200px'
                            }
                        ],
                        order: [[0, 'asc']], // Sort by S.No by default
                        dom: 't' // Only show table, no controls
                    });
                }
            }, 100);
        }

        // Show class-wise data
        function showClassWiseData() {
            document.getElementById('data-section').style.display = 'block';
            document.getElementById('data-content').innerHTML = '<div class="loading">Loading class-wise data...</div>';
            
            fetch('/api/class_wise_data')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayClassWiseData(data.classes, data.summary);
                    } else {
                        document.getElementById('data-content').innerHTML = `<div class="error">Error: ${data.message}</div>`;
                    }
                })
                .catch(error => {
                    document.getElementById('data-content').innerHTML = `<div class="error">Error loading data: ${error.message}</div>`;
                });
        }
        
        // Display class-wise data
        function displayClassWiseData(classes, summary) {
            let contentHTML = `
                <div style="background: linear-gradient(135deg, #4299e1, #3182ce); color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; text-align: center;">
                    <h2 style="margin: 0 0 1rem 0;">School Overview</h2>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem;">
                        <div>
                            <div style="font-size: 2rem; font-weight: bold;">${summary.total_students}</div>
                            <div style="opacity: 0.9; font-size: 0.9rem;">Total Students</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold;">${summary.total_male}</div>
                            <div style="opacity: 0.9; font-size: 0.9rem;">Male Students</div>
                        </div>
                        <div>
                            <div style="font-size: 2rem; font-weight: bold;">${summary.total_female}</div>
                            <div style="opacity: 0.9; font-size: 0.9rem;">Female Students</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1rem;">
            `;
            
            classes.forEach(classData => {
                contentHTML += `
                    <div style="background: #f7fafc; padding: 1.5rem; border-radius: 12px; border-left: 4px solid #4299e1; transition: transform 0.2s; cursor: pointer;" 
                         onclick="filterByClass('${classData.name}')" 
                         onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.1)'" 
                         onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                        <h3 style="color: #4299e1; margin-bottom: 1rem; display: flex; align-items: center; font-size: 1.1rem;">
                            <span style="margin-right: 0.5rem;">${classData.name === 'ECE' ? '[ART]' : '[CLASS]'}</span>
                            ${classData.name === 'ECE' ? 'ECE Class' : `Class ${classData.name}`}
                        </h3>
                        <div style="margin-bottom: 1rem;">
                            <p style="margin: 0; font-size: 0.95rem;">Total Students: <strong style="color: #2d3748;">${classData.total_students}</strong></p>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.9rem;">
                            <p style="margin: 0;">Boys: <strong style="color: #3182ce;">${classData.male_students}</strong></p>
                            <p style="margin: 0;">Girls: <strong style="color: #e53e3e;">${classData.female_students}</strong></p>
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #e2e8f0; text-align: center;">
                            <small style="color: #718096;">Click to view class details</small>
                        </div>
                    </div>
                `;
            });
            
            contentHTML += '</div>';
            document.getElementById('data-content').innerHTML = contentHTML;
        }

        // Filter by class
        function filterByClass(className) {
            document.getElementById('data-section').style.display = 'block';
            document.getElementById('data-content').innerHTML = `<div class="loading">Loading ${className} class data...</div>`;
            
            fetch(`/api/class_data/${className}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayClassStudentsTable(data.students, className);
                    } else {
                        document.getElementById('data-content').innerHTML = `<div class="error">Error: ${data.message}</div>`;
                    }
                })
                .catch(error => {
                    document.getElementById('data-content').innerHTML = `<div class="error">Error loading data: ${error.message}</div>`;
                });
        }
        
        // Display class students table
        function displayClassStudentsTable(students, className) {
            let tableHTML = `<h3 style="margin-bottom: 1rem; color: #4a5568;">Class ${className} Students (${students.length} total)</h3>`;
            
            if (students.length === 0) {
                tableHTML += `<div class="loading">No students found in ${className} class</div>`;
            } else {
                tableHTML += `
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Class S.No</th>
                                <th>Student Name</th>
                                <th>Father's Name</th>
                                <th>Section</th>
                                <th>GR#</th>
                                <th>Gender</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                students.forEach(student => {
                    tableHTML += `
                        <tr>
                            <td data-label="Class S.No">${student.class_sno || 'N/A'}</td>
                            <td data-label="Student Name">${student.student_name || 'N/A'}</td>
                            <td data-label="Father's Name">${student.father_name || 'N/A'}</td>
                            <td data-label="Section">${student.class_section || 'N/A'}</td>
                            <td data-label="GR#">${student.gr_number || 'N/A'}</td>
                            <td data-label="Gender">${student.gender || 'N/A'}</td>
                            <td data-label="Actions">
                                <button onclick="viewStudent('Class_${className}', ${student.row_number})" class="table-btn btn-view">View</button>
                                <button onclick="deleteStudent('Class_${className}', ${student.row_number}, '${student.student_name}')" class="table-btn btn-delete">Delete</button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += `
                        </tbody>
                    </table>
                `;
            }
            
            document.getElementById('data-content').innerHTML = tableHTML;
        }

        // View student
        function viewStudent(sheetName, rowNumber) {
            // Open student details in new tab
            const url = `/student_details?sheet=${encodeURIComponent(sheetName)}&row=${rowNumber}`;
            window.open(url, '_blank');
        }

        // Edit student
        function editStudent(sheetName, rowNumber) {
            // Open student edit in new tab
            const url = `/data_edit?sheet=${encodeURIComponent(sheetName)}&row=${rowNumber}`;
            window.open(url, '_blank');
        }

        // Print student
        function printStudent(sheetName, rowNumber, studentName) {
            // Open student details in new tab for printing
            const url = `/print_student?sheet=${encodeURIComponent(sheetName)}&row=${rowNumber}`;
            const printWindow = window.open(url, '_blank');
            
            // Wait for page to load then print
            printWindow.onload = function() {
                setTimeout(() => {
                    printWindow.print();
                }, 1000);
            };
        }

        // Delete student
        function deleteStudent(sheetName, rowNumber, studentName) {
            if (confirm(`Are you sure you want to delete student "${studentName}"?\n\nThis action cannot be undone and will permanently remove the student from the database.`)) {
                // Find and disable all delete buttons for this student
                const deleteButtons = document.querySelectorAll(`button[onclick*="deleteStudent('${sheetName}', ${rowNumber}"]`);
                deleteButtons.forEach(btn => {
                    btn.disabled = true;
                    btn.innerHTML = 'Deleting...';
                });
                
                fetch(`/api/delete_student/${encodeURIComponent(sheetName)}/${rowNumber}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage(data.message, 'success');
                        // Refresh the current view
                        if (window.location.href.includes('admin_dashboard')) {
                            showAllData();
                        } else {
                            location.reload();
                        }
                    } else {
                        showMessage('Error: ' + data.message, 'error');
                        // Re-enable buttons on error
                        deleteButtons.forEach(btn => {
                            btn.disabled = false;
                            btn.innerHTML = 'Delete';
                        });
                    }
                })
                .catch(error => {
                    showMessage('Error deleting student: ' + error.message, 'error');
                    // Re-enable buttons on error
                    deleteButtons.forEach(btn => {
                        btn.disabled = false;
                        btn.innerHTML = 'Delete';
                    });
                });
            }
        }

        // Filter students function
        // Toggle details function for cards
        function toggleDetails(cardId) {
            const detailsDiv = document.getElementById('details-' + cardId);
            const button = event.target;
            
            if (detailsDiv.style.display === 'none' || detailsDiv.style.display === '') {
                detailsDiv.style.display = 'block';
                button.textContent = 'Hide';
                button.style.background = '#4299e1';
                button.style.color = 'white';
            } else {
                detailsDiv.style.display = 'none';
                button.textContent = 'Details';
                button.style.background = '#f7fafc';
                button.style.color = '#4a5568';
            }
        }

        function filterStudents() {
            const searchTerm = document.getElementById('studentSearch').value.toLowerCase();
            const classFilter = document.getElementById('classFilter').value;
            const clearBtn = document.getElementById('clearSearchBtn');
            
            // Show/hide clear button
            if (searchTerm) {
                clearBtn.style.display = 'block';
            } else {
                clearBtn.style.display = 'none';
            }
            
            // Get all student rows
            const studentRows = document.querySelectorAll('.student-row');
            let visibleCount = 0;
            
            studentRows.forEach(row => {
                const studentName = row.getAttribute('data-student-name') || '';
                const fatherName = row.getAttribute('data-father-name') || '';
                const grNumber = row.getAttribute('data-gr-number') || '';
                const studentClass = row.getAttribute('data-class') || '';
                
                // Check if row matches search term
                const matchesSearch = !searchTerm || 
                    studentName.includes(searchTerm) || 
                    fatherName.includes(searchTerm) || 
                    grNumber.includes(searchTerm);
                
                // Check if row matches class filter
                const matchesClass = !classFilter || studentClass === classFilter;
                
                // Show/hide row based on filters
                if (matchesSearch && matchesClass) {
                    row.style.display = '';
                    visibleCount++;
                } else {
                    row.style.display = 'none';
                }
            });
            
            // Update visible count
            const visibleCountElement = document.getElementById('visibleCount');
            if (visibleCountElement) {
                visibleCountElement.textContent = visibleCount;
            }
            
            // Update total count display
            const totalCountElement = document.getElementById('studentCount');
            if (totalCountElement) {
                totalCountElement.textContent = visibleCount;
            }
        }

        // Clear search function
        function clearSearch() {
            document.getElementById('studentSearch').value = '';
            document.getElementById('classFilter').value = '';
            document.getElementById('clearSearchBtn').style.display = 'none';
            
            // Show all rows
            const studentRows = document.querySelectorAll('.student-row');
            studentRows.forEach(row => {
                row.style.display = '';
            });
            
            // Update counts
            const totalStudents = studentRows.length;
            const visibleCountElement = document.getElementById('visibleCount');
            const totalCountElement = document.getElementById('studentCount');
            
            if (visibleCountElement) {
                visibleCountElement.textContent = totalStudents;
            }
            if (totalCountElement) {
                totalCountElement.textContent = totalStudents;
            }
        }

        // Export student data function
        function exportStudentData() {
            showMessage('Export functionality will be implemented soon!', 'success');
        }

        // Consolidate data function
        function consolidateData() {
            if (confirm('This will consolidate all student data from all classes into a single Excel file (408070227.xlsx). Do you want to proceed?')) {
                showMessage('Starting data consolidation...', 'info');
                
                // Show loading state
                const consolidateBtn = event.target.closest('.action-btn');
                const originalText = consolidateBtn.innerHTML;
                consolidateBtn.innerHTML = '<div class="loading-spinner"></div><div>Processing...</div>';
                consolidateBtn.disabled = true;
                
                fetch('/api/consolidate_data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                .then(response => {
                    if (response.ok) {
                        // Check if response is actually a file (Excel)
                        const contentType = response.headers.get('content-type');
                        if (contentType && contentType.includes('spreadsheetml') || contentType.includes('application/octet-stream')) {
                            return response.blob();
                        } else {
                            throw new Error('Invalid response format');
                        }
                    } else if (response.status === 302 || response.status === 401) {
                        throw new Error('Authentication required. Please login as admin.');
                    } else {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Consolidation failed');
                        });
                    }
                })
                .then(blob => {
                    // Create download link
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = '408070227.xlsx';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    showMessage('Data consolidated successfully! File downloaded.', 'success');
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage(error.message || 'Error consolidating data. Please try again.', 'error');
                })
                .finally(() => {
                    // Reset button state
                    consolidateBtn.innerHTML = originalText;
                    consolidateBtn.disabled = false;
                });
            }
        }

        // Update active button
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('view-btn')) {
                document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
            }
        });
        
        // Cache refresh function
        function refreshCache() {
            const cacheIndicator = document.getElementById('cache-indicator');
            const originalText = cacheIndicator.textContent;
            
            cacheIndicator.textContent = '‚è≥';
            cacheIndicator.style.color = '#f39c12';
            
            fetch('/api/refresh_cache', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    cacheIndicator.textContent = '‚úÖ';
                    cacheIndicator.style.color = '#27ae60';
                    showMessage('Cache refreshed successfully!', 'success');
                    
                    // Reset indicator after 3 seconds
                    setTimeout(() => {
                        cacheIndicator.textContent = 'üîÑ';
                        cacheIndicator.style.color = '#4299e1';
                    }, 3000);
                } else {
                    cacheIndicator.textContent = '‚ùå';
                    cacheIndicator.style.color = '#e74c3c';
                    showMessage('Error refreshing cache: ' + data.message, 'error');
                    
                    // Reset indicator after 3 seconds
                    setTimeout(() => {
                        cacheIndicator.textContent = originalText;
                        cacheIndicator.style.color = '#4299e1';
                    }, 3000);
                }
            })
            .catch(error => {
                cacheIndicator.textContent = '‚ùå';
                cacheIndicator.style.color = '#e74c3c';
                showMessage('Error refreshing cache: ' + error.message, 'error');
                
                // Reset indicator after 3 seconds
                setTimeout(() => {
                    cacheIndicator.textContent = originalText;
                    cacheIndicator.style.color = '#4299e1';
                }, 3000);
            });
        }
    </script>
    
    <!-- DataTables JavaScript for better mobile experience -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
</body>
</html>